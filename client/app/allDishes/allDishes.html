<link rel="stylesheet" href="../../styles/allDishes.css">

<!-- REFACTOR TO NAVBAR LATER -->
<ul>
  <li class="active"><a class="allDishes" ui-sref="event.allDishes">All Dishes</a></li>
  <li><a class="addDish" ui-sref="event.addDish">Add Dish</a></li>
  <li><a class="guestBill" ui-sref="event.guestBill">Your Bill</a></li>
  <li><a class="hostBill" ui-sref="event.hostBill" ng-show="allDishes.isHost" >Final Bill</a></li>
</ul>
<!-- /Navbar refactor -->



<div class="row" id="allDishes" ng-cloak>
  <div class="col s12">

    <!-- Header -->
    <header>
      <h5>All Dishes</h5>
      <div class="divider"></div>
      <p>Hi, {{_.capitalize(allDishes.username)}}.
      The code for this bill is <strong class="code">{{ allDishes.code }}</strong>.</p>
      <p>Give this code to everyone around the table so they can join the bill from their phones and add their own dishes.</p>
    </header>

    <!-- Dish items -->
    <ul class="collection" ng-repeat="dish in allDishes.data.dishes">
      <li class="collection-item" ng-if="dish.users.length !== 0">
        {{ _.map(dish.name.split(" "), _.capitalize).join(" ") }}
        <br>
        Cost: {{dish.cost | currency }}
        <br>
        <small class="sharedBy">{{ allDishes.getUsersByDish(dish, allDishes.data.users) }} got this.</small>

        <!-- Share/unshare buttons -->
        <span class="button">
          <div class="button__background waves-effect waves-light btn">
            <i class="material-icons button--edit share" ng-hide="allDishes.isOnDish(dish.users, allDishes.user_id)" ng-click="allDishes.shareDish(dish.dish_id, allDishes.user_id, dish.users)">add_circle_outline</i>
            <i class="material-icons button--edit unshare" ng-show="allDishes.isOnDish(dish.users, allDishes.user_id)" ng-click="allDishes.unshareDish(dish.dish_id, allDishes.user_id, dish.users)">clear</i>
          </div>
        </span>
      </li>
    </ul>

    <!-- Add Dish button -->
    <a class="button--addDish btn-floating btn-large waves-effect waves-light btn red modal-trigger" data-target="addDish"><i class="material-icons">add</i></a>



    <!-- ADD DISH MODAL -->
    <div id="addDish" class="modal">
      <div class="modal__box">

        <h5 class="modal__title">Add A Dish</h5>

        <!-- Form -->
        <form role="form" name="dishForm">
          <div class="modal__input--dish input-field col s8">
            <input name="name" type="text" placeholder="Dish Name" ng-model="allDishes.dishName" class="dishName" aria-label="dish name" required>
          </div>
          <div class="modal__input--cost input-field col s4">
            <input name="amount" type="number" step="0.01" placeholder="$ 0.00" ng-model="allDishes.amount" class="dishCost" id="addDish" aria-label="amount" required>
          </div>
        </form>

        <!-- Dish cost display -->
        <div class="modal--costInfo">
          This dish costs
          <strong><span ng-show="dishForm.amount.$pristine">
            {{ 0 + allDishes.amount | currency}}
          </span>
          <span ng-show="dishForm.amount.$dirty" id="currency-default">
            {{ 0 + allDishes.amount | currency}}
          </span></strong>
          and your total so far is <strong><span id="currency-default">{{allDishes.calcUserCurrentTotal(allDishes.data) | currency}}</span></strong>.
          <!-- <div ng-show="allDishes.addedDish" class="modal__div--success">
            <p class="modal__text--success">
              {{ _.map(allDishes.previousDish.split(" "), _.capitalize).join(" ") }} added!
            </p>
          </div>
          <br ng-hide="allDishes.addedDish"> -->
        </div>
      </div>

      <!-- Add Dish/Cancel buttons -->
      <div id="modal-footer" class="modal-footer">
        <button type="submit" ng-disabled="dishForm.amount.$error.required || dishForm.name.$error.required" ng-click="allDishes.addDish(allDishes.dishName, allDishes.amount)" class="addDish btn btn-default" >
        Add Dish
        </button>
        <a ui-sref="event.allDishes" class="modal-action modal-close waves-effect waves-green btn-flat ">Cancel</a>
      </div>
    </div>
  </div>
</div>
